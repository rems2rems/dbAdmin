// Generated by CoffeeScript 1.9.2
(function() {
  var Promise, config, configDb, configDbName, createUsers, createViews, dataDb, dataDbName, dbDriver, dbName, insert_apiary, insert_beehouse, insert_location, insert_stand, promisify_db, usersDb;

  insert_location = require('./insert_location');

  insert_apiary = require('./insert_apiary');

  insert_stand = require('./insert_stand');

  insert_beehouse = require('./insert_beehouse');

  config = require('./config');

  dbDriver = require('../../openbeelab-db-util/javascript/dbUtil').configuredDriver(config.database);

  promisify_db = require('../../openbeelab-db-util/javascript/promisify_cradle');

  dbName = config.database.name;

  usersDb = dbDriver.database("_users");

  usersDb = promisify_db(usersDb);

  configDbName = dbName + "_config";

  configDb = dbDriver.database(configDbName);

  configDb = promisify_db(configDb);

  dataDbName = dbName + "_data";

  dataDb = dbDriver.database(dataDbName);

  dataDb = promisify_db(dataDb);

  Promise = require("promise");

  createViews = require('./create_views');

  createUsers = require('./create_users');

  configDb.create().then(function() {
    return createViews(configDb, "config");
  }).then(function() {
    return createUsers(usersDb, configDb, dbName);
  }).then(function() {
    return console.log("config db created.");
  }).then(function() {
    var location;
    location = config.database.configObjects.location;
    return insert_location(configDb, location);
  }).then(function() {
    var p1, p2;
    console.log("location created.");
    p1 = configDb.save(config.database.configObjects.beehouse_model);
    p2 = configDb.save(config.database.configObjects.beehouse);
    return Promise.all([p1, p2]);
  }).then(function() {
    var stand;
    console.log("beehouse created.");
    stand = config.database.configObjects.stand;
    return configDb.save(stand);
  }).then(function() {
    console.log("stand created.");
    return dataDb.create();
  }).then(function() {
    return createViews(dataDb, "data");
  }).then(function() {
    return console.log("data db created.");
  })["catch"](function(err) {
    return console.log(err);
  });

}).call(this);
