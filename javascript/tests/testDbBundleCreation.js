// Generated by CoffeeScript 1.9.2
(function() {
  var Promise, config, createBundle, dbDriver, dbServer, expect, promisify_db, util;

  expect = require('must');

  require('../../../openbeelab-util/javascript/objectUtils').install();

  config = require('../config').clone();

  createBundle = require('../create_bundle');

  promisify_db = require('../../../openbeelab-db-util/javascript/promisify_dbDriver');

  dbDriver = require('../../../openbeelab-db-util/javascript/mockDriver');

  dbServer = dbDriver.connectToServer(config.database);

  Promise = require('promise');

  util = require('util');

  describe("create a bundled db", function() {
    before(function(done) {
      return dbServer.useDb("_users").create().then(done)["catch"](function(err) {
        console.log(err);
        return done(err);
      });
    });
    after(function(done) {
      dbServer.deleteDb(config.database.name + "_config");
      dbServer.deleteDb(config.database.name + "_data");
      dbServer.deleteDb("_users");
      return done();
    });
    return it("should work", function(done) {
      return createBundle(config, dbServer).then(function() {
        var configDb, dataDb, usersDb;
        configDb = dbDriver.connectToServer(config.database).useDb(config.database.name + "_config");
        dataDb = dbDriver.connectToServer(config.database).useDb(config.database.name + "_data");
        usersDb = dbDriver.connectToServer(config.database).useDb("_users");
        configDb.exists().must.eventually.be["true"]();
        dataDb.exists().must.eventually.be["true"]();
        return done();
      })["catch"](function(err) {
        return done(err);
      });
    });
  });

}).call(this);
