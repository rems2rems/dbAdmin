// Generated by CoffeeScript 1.10.0
(function() {
  var Promise, config, createBundle, dbDriver, dbServer, expect, promisify_db;

  expect = require('must');

  require('../../../openbeelab-util/javascript/objectUtils').install();

  config = require('../config').clone();

  createBundle = require('../create_bundle');

  promisify_db = require('../../../openbeelab-db-util/javascript/promisify_dbDriver');

  dbDriver = require('../../../openbeelab-db-util/javascript/mockDriver');

  dbServer = dbDriver.connectToServer(config.database);

  Promise = require('promise');

  describe("create a bundled db", function() {
    return it("should work", function(done) {
      return createBundle(config, dbServer).then(function() {
        var configDb, dataDb, usersDb;
        configDb = dbDriver.connectToServer(dbConfig.database).useDb(config.database.name + "_config");
        dataDb = dbDriver.connectToServer(dbConfig.database).useDb(config.database.name + "_data");
        usersDb = dbDriver.connectToServer(dbConfig.database).useDb("_users");
        configDb.exists().must.eventually.be["true"]();
        dataDb.exists().must.eventually.be["true"]();
        console.log("ici c bon");
        usersDb.get("org.couchdb.user:remy").then(function(user) {
          return user.name.must.be("remy");
        });
        usersDb.get("org.couchdb.user:pierre").then(function(user) {
          return user.name.must.be("pierre");
        });
        return done();
      })["catch"](function(err) {
        return done(err);
      });
    });
  });

}).call(this);
